{"version":3,"sources":["src/model_rotation_controller.js"],"names":[],"mappings":"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","file":"src/model_rotation_controller.js","sourcesContent":["define([\"three\"], function(THREE){\n    return {new: function(modelId, model, inputBus, rotationHandlerMaker){\n        var ModelController = {\n            rotationHandler: undefined,\n            inputBus: inputBus,\n            modelId: modelId,\n            crosshairRadius: 0.01,\n            crosshairColour: 0xff0000,\n            crosshairLineWidth: 2,\n           init: function(scene, camera, light){\n               this.model = model;\n               scene.add(this.model);\n               this.rotationHandler = rotationHandlerMaker.new(this.model, scene, camera);\n               camera.position.z = 7.5; // TODO: make configurable\n               this.light = light;\n               this.light.position.set(0,0,10);\n               this.light.target = this.model;\n               scene.add(this.light);\n               this.camera = camera;\n               this.scene = scene;\n           },\n           drawCrosshairs: function(){\n               window.log.debug(\"Drawing crosshairs\");\n                var segments = 64,\n                geometry = new THREE.CircleGeometry(this.crosshairRadius, segments);\n                geometry.vertices.shift(); // remove center\n\n                this.crosshair = new THREE.Line(geometry, new THREE.LineBasicMaterial({\n                        color: this.crosshairColour,\n                        linewidth: this.crosshairLineWidth}));\n                this.crosshair.position.set(0,0,7);\n                this.scene.add(this.crosshair);\n           },\n           inBounds: function(x, y){\n               return x >= this.leftBound && x <= this.rightBound && \n                       y >= this.bottomBound && y <= this.topBound;\n           },\n           render: function(scene, camera, dim){\n               this.leftBound = dim.scene.left;\n               this.rightBound = this.leftBound + dim.scene.width; \n               this.bottomBound = dim.scene.bottom;\n               this.topBound = this.bottomBound + dim.scene.height; \n           },\n           mouseDownHandler: function(name, event){\n               if(this.inBounds(event.actualX, event.actualY)){\n                   this.mouseDown = true;\n                   this.downMousePos = [event.actualX, event.actualY];\n                   this.rotationHandler.startRotation(this.downMousePos, this.dim());\n               }\n               this.updateCursor(event);\n           },\n           mouseUpHandler: function(name, event){\n               this.mouseDown = false;\n               this.rotationHandler.endRotation();\n               this.updateCursor(event);\n           },\n           mouseMoveHandler: function(name, event){\n               if(this.mouseDown){\n                   this.rotationHandler.updateRotation(event.actualX, event.actualY, this.dim()); \n               }\n               this.updateCursor(event);\n           },\n           updateCursor: function(event){\n               var inBounds = this.inBounds(event.actualX, event.actualY),\n                   cursorType = this.rotationHandler.cursorType(event.actualX, event.actualY, this.dim());\n                if(cursorType === null){\n                    // do nothing\n                } else if(inBounds){\n                   this.setCursor(cursorType);\n                } else if(!inBounds && cursorType != \"grabbing\"){ // TODO: this assumes only one active rotation controller\n                    this.setCursor(\"\");\n                }\n           },\n\n           setCursor: function(style){\n                $(\"body\").css(\"cursor\", style);\n           },\n\n           getCursor: function(){\n                return $(\"body\").css(\"cursor\");\n           },\n\n           dim: function(){\n               return {\n                   leftBound: this.leftBound,\n                   rightBound: this.rightBound,\n                   bottomBound: this.bottomBound,\n                   topBound: this.topBound,\n               };\n           },\n           registerMouseHandlers: function(){\n               var that = this;\n               this.mouseDown = false;\n               this.downMousePos = [0,0];\n               this.inputBus.registerConsumer(\"down\", this.modelId+\"_rotateModelMouseDown\", function(name, event){\n                  that.mouseDownHandler(name, event); \n               });\n               this.inputBus.registerConsumer(\"up\", this.modelId+\"_rotateModelMouseUp\", function(name, event){\n                  that.mouseUpHandler(name, event); \n               });\n               this.inputBus.registerConsumer(\"move\", this.modelId+\"_rotateModelMouseMove\", function(name, event){\n                  that.mouseMoveHandler(name, event); \n               });\n           },\n\n           deregisterMouseHandlers: function(){\n               this.inputBus.deregisterConsumer(\"down\", this.modelId+\"_rotateModelMouseDown\");\n               this.inputBus.deregisterConsumer(\"up\", this.modelId+\"_rotateModelMouseUp\");\n               this.inputBus.deregisterConsumer(\"move\", this.modelId+\"_rotateModelMouseMove\");           \n            },\n        };\n\n        ModelController.registerMouseHandlers(); \n\n        return ModelController;\n    }};\n});\n"]}