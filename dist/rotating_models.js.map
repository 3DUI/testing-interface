{"version":3,"sources":["src/rotating_models.js"],"names":[],"mappings":"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","file":"src/rotating_models.js","sourcesContent":["// TODO: break this up into smaller modules\n// TODO: make this a react component\ndefine([\"jquery\", \"dist/render_loop\", \"dist/mouse_input_bus\", \"dist/two_axis_valuator\", \"dist/arcball\", \"dist/discrete\", \"dist/dummy_rotation_handler\", \"dist/build_rotation_scene\", \"dist/user_feedback\", \"dist/timer\", \"react\", \"dist/experiment_ui\", \"dist/name_map\"], function($, RenderLoop, MouseInputBus, TwoAxisValuator, Arcball, Discrete, DummyRotationHandler, RotationSceneBuilder, UserFeedback, Timer, React, ExperimentUI, NameMap){\n    return function(callback, experiment){\n        React.render(\n            <ExperimentUI \n                timed={experiment.limit ? \"true\" : \"false\"}\n                title={experiment.title}/>,\n            document.getElementById(\"content\")\n        );\n        var views = {ref: {left:0,\n                      bottom:0, \n                      width:0.5, \n                      height:1.0, \n                      background:new THREE.Color().setRGB( 0.5, 0.5, 0.7 )},\n                     player: {left:0.5, \n                      bottom:0, \n                      width:0.5, \n                      height:1.0, \n                      background:new THREE.Color().setRGB( 0.5, 0.5, 0.5 )},\n                     full: {left:0,\n                      bottom:0,\n                      height:1,\n                      width:1,\n                      background:new THREE.Color().setRGB( 0.7, 0.5, 0.7 )},\n                      };\n        var playerController,\n            highlightedColour = 0xff0000,\n            playerControllerName,\n            inputBus = MouseInputBus(\"#three\"),\n            controllers = {},\n            i = 0, // TODO: remove\n            totalTasksCompleted = 0,\n            totalTasks = 0,\n            currentGroup = -1,\n            currentIndex,\n            possibleIndices = [], // TODO\n\n            setupScene = function(id, rotationBuilder, task, view){\n               inputBus.deregisterConsumer(\"down\", id+\"_rotateModelMouseDown\");\n               inputBus.deregisterConsumer(\"up\", id+\"_rotateModelMouseUp\");\n               inputBus.deregisterConsumer(\"move\", id+\"_rotateModelMouseMove\");           \n                var builder = RotationSceneBuilder();\n                builder.materialsCallback = function(materials){\n                    return materials;\n                }\n                builder.setModelUrl(task.type === \"orientation\" ? experiment.orientationModelUrl : task.model).setInputBus(inputBus).setRenderLoop(RenderLoop);\n                return builder.setId(id).setView(view).setRotationBuilder(rotationBuilder).build(\n                    function(controller){\n                        var rot = controller.model.rotation;\n                        rot.x = task[id + \"_orientation\"][0];\n                        rot.y = task[id + \"_orientation\"][1];\n                        rot.z = task[id + \"_orientation\"][2];\n                        controllers[id] = controller;\n                        if(task.type === \"inspection\"){\n                            controller.drawCrosshairs();\n                        }\n                    }\n                );\n            },\n            showLabels = function(showOrientation){\n                var hideId,\n                    showId,\n                    orientation = \"#orientation-labels\",\n                    inspection = \"#inspection-labels\";\n                if(showOrientation){\n                    hideId = inspection;\n                    showId = orientation;\n                } else {\n                    hideId = orientation;\n                    showId = inspection;\n                }\n                $(hideId).hide();\n                $(showId).show();\n            }, //TODO: set this to state in the react component\n            setupScenes = function(task){\n               RenderLoop.removeView(\"ref\");\n               RenderLoop.removeView(\"player\");\n               if(task.type === \"orientation\"){\n                   setupScene(\"ref\", DummyRotationHandler, task, views.ref);\n                   setupScene(\"player\", playerController, task, views.player);\n                   showLabels(true);\n               } else if(task.type === \"inspection\"){\n                   setupScene(\"player\", playerController, task, views.full);\n                   showLabels(false);\n               }\n            },\n\n            loadTask = function(tasks, group, index){\n                window.log.debug(\"Loading tasks\", tasks, group, index);\n                // TODO: MAKE IT SO WE DON'T HAVE TO DO THIS\n                if(group == -1){\n                    return nextTask(tasks, true);\n                }\n                var task;\n                if(group < tasks.length && index < tasks[group].length){\n                    task = tasks[group][index];\n                    setupScenes(task);\n                    UserFeedback(experiment.title, task, totalTasksCompleted, totalTasks, playerControllerName);\n                    return true;\n                }\n                return false;\n            },\n\n            shuffle = function(arr){\n                for(var i = arr.length - 1; i > 0; i--){\n                    var j = Math.floor(Math.random() * (i+1));\n                    var temp = arr[i];\n                    arr[i] = arr[j];\n                    arr[j] = temp;\n                }\n                return arr;\n            },\n\n            nextTask = function(tasks, notCompleted){\n                if(!notCompleted){\n                    totalTasksCompleted++;\n                }\n                if(possibleIndices.length == 0){\n                    currentGroup++;\n                    if(currentGroup == tasks.length){\n                        if(experiment.limit){\n                            totalTasksCompleted = 0;\n                            currentGroup = 0;\n                        } else {\n                            teardown();\n                            return;\n                        }\n                    }\n                    var numTasks = tasks[currentGroup].length,\n                        indices = [];\n                    for(var i = 0; i < numTasks; i++){\n                        indices.push(i);   \n                    }\n                    possibleIndices = shuffle(indices);\n                    window.log.debug(\"Set possible indices to\", possibleIndices);\n                }\n                currentIndex = possibleIndices.pop();\n                loadTask(tasks, currentGroup, currentIndex);\n            },\n\n            loadRotationController = function(rotationController, tasks){\n                playerController = rotationController.controller;\n                playerControllerName = rotationController.name;\n                enable_buttons();\n                disable_button(rotationController);\n                if(tasks){\n                    loadTask(tasks, currentGroup, currentIndex);\n                }\n            },\n            rotationControllers = {\n                discrete: {id:\"#discrete\", controller: Discrete, name: NameMap(\"discrete\")},\n                twoaxis: {id:\"#two-axis\", controller: TwoAxisValuator, name: NameMap(\"twoaxis\")},\n                arcball: {id:\"#arcball\", controller: Arcball, name: NameMap(\"arcball\")}\n            },\n            enable_buttons = function(){\n                for(var key in rotationControllers){\n                    if(rotationControllers.hasOwnProperty(key)){\n                        $(rotationControllers[key].id).prop(\"disabled\", false);\n                    }\n                }\n            },\n            disable_button = function(rotationController){\n                $(rotationController.id).prop(\"disabled\", true);\n            }, // TODO: have this as logic in the buttons react component thing\n            teardown = function(){\n                timer.stop();\n                React.unmountComponentAtNode(document.getElementById('content'));\n                inputBus.teardown();\n                callback();\n            }, \n            countAndSetTotal = function(tasks){\n                for(var i = 0; i < tasks.length; i++){\n                    for(var j = 0; j < tasks[i].length; j++){\n                       totalTasks++; \n                    }\n                }\n            },\n            limitCallback = experiment.limit? teardown: undefined,\n            timer = new Timer(\"#timer\", experiment.limit, limitCallback);\n\n        // SETUP UI;\n        loadRotationController(rotationControllers[experiment.controllerKey]);\n\n        RenderLoop.init({widthScale: 1, heightScale:0.7, widthOffset:0, heightOffset:0}, document.getElementById(\"three\"));\n        RenderLoop.start();\n        timer.start();\n        $.getJSON(experiment.taskUrl, function(data) {\n            countAndSetTotal(data);\n            $(\"#save\").click(function(){\n                var rotation = controllers.player.model.rotation;\n                var quaternion = controllers.player.model.quaternion;\n                window.log.saveLog(\"saving user task\", currentGroup, currentIndex, [rotation.x, rotation.y, rotation.z], [quaternion.x, quaternion.y, quaternion.z, quaternion.w], timer.time);\n                nextTask(data);\n            });\n            $(\"#reload\").click(function(){\n                window.log.debug(\"reload\",\"task\", data[i], \"orientation\", controllers.player.model.rotation);\n                loadTask(data, currentGroup, currentIndex);\n            });\n            for(var key in rotationControllers){\n                if(rotationControllers.hasOwnProperty(key)){\n                    (function(key){\n                        var rotationController = rotationControllers[key]\n                        $(rotationController.id).click(function(){\n                            loadRotationController(rotationController, data);\n                        });\n                    })(key)\n                }\n            }\n            loadTask(data, currentGroup, currentIndex);\n        });\n    };\n});\n"]}