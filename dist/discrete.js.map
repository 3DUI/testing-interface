{"version":3,"sources":["src/discrete.js"],"names":[],"mappings":"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","file":"src/discrete.js","sourcesContent":["define([\"three\", \"dist/arcball\", \"dist/rotation_helper\"], function(THREE, Arcball, RotationHelper){\n    return {new: function(model, scene, camera){\n        var X_AXIS = \"x\";\n        var Y_AXIS = \"y\";\n        var Z_AXIS = \"z\";\n\n        var Controller = {\n            fudgeFactor: 0.1,\n            radius: 4, //TODO: make this configurable\n\n            fudgeZ: 0.95, // circles don't look like they touch due to perspective,\n                         // so we fudge the z a bit here\n            displayRadius: 4.5,\n\n            rotating: false,\n            rotationGuideWidth: 2,\n\n            init: function(model, scene, camera){\n                this.model = model;\n                this.camera = camera;\n                this.arcball = Arcball.new(model, scene, camera);\n                this.arcball.hideGuide(true);\n                this.buildRotationGuides(scene);\n                this.rotationFunction = null;\n            },\n\n            /**\n             * Create the sphere around the model\n             */\n            buildRotationGuides: function(scene){\n                    var segments = 64,\n                    geometry = new THREE.CircleGeometry(this.radius, segments);\n                geometry.vertices.shift(); // remove center\n\n                this.rotationColour = {\n                    x: 0xff0000,\n                    y: 0x00ff00,\n                    z: 0x0000ff \n                };\n\n                this.rotationGuides = {\n                    y: new THREE.Line(geometry, new THREE.LineBasicMaterial({\n                        color: this.rotationColour.y,\n                        linewidth: this.rotationGuideWidth})),\n                    x: new THREE.Line(geometry, new THREE.LineBasicMaterial({\n                        color: this.rotationColour.x,\n                        linewidth: this.rotationGuideWidth})),\n                    z: new THREE.Line(geometry, new THREE.LineBasicMaterial({\n                        color: this.rotationColour.z,\n                        linewidth: this.rotationGuideWidth})),\n                };\n                scene.add(this.rotationGuides.x);\n                scene.add(this.rotationGuides.y);\n                scene.add(this.rotationGuides.z);\n\n                RotationHelper.rotateByAxisAngle(this.rotationGuides.y, RotationHelper.axes.x, Math.PI/2);\n                RotationHelper.rotateByAxisAngle(this.rotationGuides.x, RotationHelper.axes.y, Math.PI/2);\n                this.rotationGuides.z.position.z = this.fudgeZ;\n            },\n\n            iterateAlongAxis: function(callback){\n                [X_AXIS, Y_AXIS, Z_AXIS].forEach(callback);\n            },\n\n            updateRotation: function(mouseX, mouseY, dim){\n                var that = this;\n                if(this.rotating){\n                    this.rotationFunction(mouseX, mouseY, dim);\n                }\n            },\n\n            getRotateAlongAxisFn: function(axis){\n                var that = this;\n\n                this.initialMouseReal = RotationHelper.snapToAxis(this.initialMouseReal, axis);\n                this.axisRotating = axis;\n                this.rotationGuides[axis].material.color.setHex(0xffffff);\n                return function(mouseX, mouseY, dim){\n                    var point = RotationHelper.getRealPosition(mouseX, mouseY, dim, that.camera);\n                    var angle = RotationHelper.sliderAngle(point, that.initialMouseReal, axis, that.radius);\n                    var rotationVec = RotationHelper.axes[axis];\n                    RotationHelper.rotateByAxisAngle(that.model, rotationVec, angle);\n                    that.initialMouseReal = point;\n                };\n            },\n\n            startRotation: function(initialMousePos, dim){\n                this.initialMouseReal = RotationHelper.getRealPosition(initialMousePos[0], initialMousePos[1], dim, this.camera);\n                this.rotating = true; \n\n                // check whether they're clicking a slider\n                var cursorAxis = this.cursorOverAxis(this.initialMouseReal);\n                if(cursorAxis){\n                    this.rotationFunction = this.getRotateAlongAxisFn(cursorAxis);\n                } else {\n                    this.arcball.startRotation(initialMousePos, dim);\n                    this.arcball.hideGuide(false);\n                    this.axisRotating = null;\n                    this.rotationFunction = function(mouseX, mouseY, dim){\n                        return this.arcball.updateRotation(mouseX, mouseY, dim);\n                    };\n                }\n            },\n\n            cursorOverAxis: function(realPos){\n                if(RotationHelper.checkWithinFudge(realPos.x, this.fudgeFactor)){\n                    return X_AXIS;\n                } else if (RotationHelper.checkWithinFudge(realPos.y, this.fudgeFactor)){\n                    return Y_AXIS;\n                } else if (RotationHelper.checkWithinFudge(realPos.length() - this.displayRadius, 3 * this.fudgeFactor)){\n                   return Z_AXIS; \n                }\n                return null;\n            },\n\n            cursorOverArcball: function(realPos){\n                return realPos.length() < this.displayRadius;\n            },\n\n            cursorType: function(mouseX, mouseY, dim){\n                if(this.rotating){\n                    return \"grabbing\";\n                } else {\n                    var realPos = RotationHelper.getRealPosition(mouseX, mouseY, dim, this.camera);\n                    if(this.cursorOverAxis(realPos)){\n                        return \"pointer\";\n                    } else if(this.cursorOverArcball(realPos)){ \n                        return \"grab\";\n                    } else {\n                        return \"\";\n                    }\n                }\n            },\n\n            endRotation: function(){\n                this.rotationFunction = null;\n                this.arcball.endRotation();\n                this.rotating = false;\n                if(this.axisRotating){\n                    this.rotationGuides[this.axisRotating].material.color.setHex(\n                        this.rotationColour[this.axisRotating]\n                    );\n                    this.axisRotating = null;\n                }\n                this.arcball.hideGuide(true);\n            },\n        };\n        Controller.init(model, scene, camera);\n        return Controller;\n    }};\n});\n"]}